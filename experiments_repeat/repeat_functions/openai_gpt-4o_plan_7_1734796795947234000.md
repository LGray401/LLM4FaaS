{
  "id": "chatcmpl-AgwB8g4AiDcWnC0xtYc6hsheZaQOZ",
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "Based on the functional description and the provided source code, here is a `function.py` file that implements the main function to execute the described smart home plans:\n\n```python\nfrom home_plan import home_plan, get_room_actuators\nfrom datetime import datetime, time\nimport time as time_module\n\ndef morning_plan(home):\n    # 7:00 Wake Up\n    wake_up_time = time(7, 0)\n    music_time = time(7, 5)\n    coffee_time = time(7, 20)\n\n    current_time = datetime.now().time()\n\n    if current_time >= wake_up_time:\n        print(\"Wake up! It's 7:00 AM\")\n        logger.info(\"Wake up! It's 7:00 AM\")\n\n    if current_time >= music_time:\n        # Get the music player in the bedroom\n        bedroom = get_room_actuators(home, \"Bedroom\")\n        music_player = next((actuator for actuator in bedroom if actuator.actuator_type == \"MusicPlayer\"), None)\n        if music_player:\n            music_player.turn_on()\n            music_player.play_music(\"周杰伦歌单\")\n\n    if current_time >= coffee_time:\n        # Get the coffee machine in the kitchen\n        kitchen = get_room_actuators(home, \"Kitchen\")\n        coffee_machine = next((actuator for actuator in kitchen if actuator.actuator_type == \"CoffeeMachine\"), None)\n        if coffee_machine:\n            coffee_machine.turn_on()\n            coffee_machine.make_coffee(\"espresso\")\n\n\ndef leave_home_plan(home):\n    # After 7:30, lock the door and turn off lights and sockets\n    leave_time = time(7, 30)\n    current_time = datetime.now().time()\n\n    if current_time >= leave_time:\n        print(\"Executing Leave Home Plan\")\n        logger.info(\"Executing Leave Home Plan\")\n\n        # Lock doors\n        doors = get_all_actuators(home, \"Door\")\n        for door in doors:\n            door.lock()\n\n        # Turn off lights and sockets\n        lights = get_all_actuators(home, \"Light\")\n        for light in lights:\n            light.turn_off()\n\n        sockets = get_all_actuators(home, \"SmartSocket\")\n        for socket in sockets:\n            socket.turn_off()\n\n\ndef movie_plan(home):\n    # When playing a movie, close curtains and dim lights\n    print(\"Executing Movie Plan\")\n    logger.info(\"Executing Movie Plan\")\n\n    # Get the living room actuators\n    living_room = get_room_actuators(home, \"LivingRoom\")\n    curtains = [actuator for actuator in living_room if actuator.actuator_type == \"Curtain\"]\n    lights = [actuator for actuator in living_room if actuator.actuator_type == \"Light\"]\n\n    # Close curtains\n    for curtain in curtains:\n        curtain.turn_off()\n\n    # Dim lights\n    for light in lights:\n        light.turn_on()\n        light.set_brightness_level(\"low\")\n\n\ndef main():\n    home = home_plan()\n    while True:\n        morning_plan(home)\n        leave_home_plan(home)\n        # Assume a trigger event for movie plan\n        # movie_plan(home)  # This can be triggered by an event such as playing a movie\n        time_module.sleep(60)  # Check every minute\n\n\nif __name__ == \"__main__\":\n    main()\n```\n\n### Explanation:\n\n1. **Morning Plan**: \n   - At 7:00 AM, print a wake-up message.\n   - At 7:05 AM, turn on the music player in the bedroom and play the specified playlist.\n   - At 7:20 AM, turn on the coffee machine in the kitchen and make coffee.\n\n2. **Leave Home Plan**:\n   - After 7:30 AM, lock all doors, turn off all lights, and turn off all smart sockets.\n\n3. **Movie Plan**:\n   - When playing a movie, close the curtains and dim the lights in the living room.\n  \n4. **Main Function**:\n   - Initializes the home setup and continuously checks and executes plans every minute. The movie plan would typically be triggered by an event, such as starting a movie on a smart TV.\n\nEnsure you have proper logging set up in your `home.logger_config` if you want to capture logs. The movie plan trigger is commented out and could be activated based on an external event or condition.",
        "role": "assistant",
        "refusal": null
      }
    }
  ],
  "created": 1734796778,
  "model": "gpt-4o-2024-08-06",
  "object": "chat.completion",
  "system_fingerprint": "fp_d28bcae782",
  "usage": {
    "completion_tokens": 895,
    "prompt_tokens": 4365,
    "total_tokens": 5260,
    "prompt_tokens_details": {
      "cached_tokens": 4224,
      "audio_tokens": 0
    },
    "completion_tokens_details": {
      "reasoning_tokens": 0,
      "audio_tokens": 0,
      "accepted_prediction_tokens": 0,
      "rejected_prediction_tokens": 0
    }
  }
}